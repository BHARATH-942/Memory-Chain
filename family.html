<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree - MemoryChain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-teal: #1a4d4d;
            --warm-gold: #d4af37;
            --soft-ivory: #f8f6f0;
            --charcoal: #2c2c2c;
            --off-white: #fafafa;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--off-white) 0%, var(--soft-ivory) 100%);
            min-height: 100vh;
        }
        
        .family-tree-container {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            transform: scale(1.1);
        }
        
        .node circle {
            fill: var(--primary-teal);
            stroke: var(--warm-gold);
            stroke-width: 3px;
            filter: drop-shadow(0 4px 8px rgba(26, 77, 77, 0.3));
        }
        
        .node text {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 600;
            fill: white;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .link {
            fill: none;
            stroke: var(--warm-gold);
            stroke-width: 2px;
            opacity: 0.8;
        }
        
        .member-card {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .member-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(26, 77, 77, 0.15);
        }
        
        .memory-count {
            background: linear-gradient(135deg, var(--primary-teal) 0%, var(--warm-gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--warm-gold);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .tree-controls {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .zoom-controls button {
            transition: all 0.2s ease;
        }
        
        .zoom-controls button:hover {
            background: var(--primary-teal);
            color: white;
        }
        
        .relationship-line {
            stroke: var(--warm-gold);
            stroke-width: 2;
            opacity: 0.6;
        }
        
        .generation-label {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 600;
            fill: var(--primary-teal);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-teal-700 to-yellow-600 flex items-center justify-center">
                        <span class="text-white font-bold text-sm">MC</span>
                    </div>
                    <span class="text-xl font-bold text-gray-900">MemoryChain</span>
                </div>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="nav-link text-gray-600 hover:text-gray-900">Dashboard</a>
                    <a href="upload.html" class="nav-link text-gray-600 hover:text-gray-900">Upload</a>
                    <a href="family.html" class="nav-link text-gray-900 font-medium">Family</a>
                    <a href="legacy.html" class="nav-link text-gray-600 hover:text-gray-900">Legacy</a>
                    <a href="nft.html" class="nav-link text-gray-600 hover:text-gray-900">NFTs</a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div id="walletStatus" class="hidden">
                        <span class="text-sm text-gray-600">Connected: </span>
                        <span id="walletAddress" class="text-sm font-mono text-teal-700"></span>
                    </div>
                    <button id="connectWallet" class="bg-gradient-to-r from-teal-700 to-yellow-600 px-4 py-2 rounded-lg text-white font-medium hover:shadow-lg transition-all">
                        Connect Wallet
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-16 min-h-screen">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">Family Tree</h1>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    Visualize your family connections and manage shared memories across generations.
                </p>
            </div>
            
            <!-- Controls -->
            <div class="flex flex-col sm:flex-row justify-between items-center mb-8 space-y-4 sm:space-y-0">
                <div class="flex items-center space-x-4">
                    <button id="addMemberBtn" class="bg-teal-700 text-white px-4 py-2 rounded-lg hover:bg-teal-800 transition-colors flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Add Member</span>
                    </button>
                    <button id="expandAllBtn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors">
                        Expand All
                    </button>
                    <button id="collapseAllBtn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors">
                        Collapse All
                    </button>
                </div>
                
                <div class="tree-controls flex items-center space-x-2 px-4 py-2 rounded-lg">
                    <div class="zoom-controls flex items-center space-x-1">
                        <button id="zoomOut" class="p-2 rounded hover:bg-gray-100 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path>
                            </svg>
                        </button>
                        <span id="zoomLevel" class="text-sm font-medium px-2">100%</span>
                        <button id="zoomIn" class="p-2 rounded hover:bg-gray-100 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="w-px h-6 bg-gray-300"></div>
                    <button id="resetView" class="p-2 rounded hover:bg-gray-100 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Family Tree Container -->
            <div class="family-tree-container">
                <div id="familyTree" class="w-full h-96"></div>
            </div>
            
            <!-- Family Members Grid -->
            <div class="mt-12">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Family Members</h2>
                <div id="familyGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Family member cards will be generated here -->
                </div>
            </div>
            
            <!-- Shared Memories -->
            <div class="mt-12">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Shared Memories</h2>
                <div id="sharedMemories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Shared memories will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="addMemberModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">Add Family Member</h3>
                <button id="closeAddModal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="addMemberForm" class="space-y-4">
                <div>
                    <label for="memberName" class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input type="text" id="memberName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="Enter full name">
                </div>
                
                <div>
                    <label for="memberRelationship" class="block text-sm font-medium text-gray-700 mb-2">Relationship</label>
                    <select id="memberRelationship" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                        <option value="">Select relationship</option>
                        <option value="parent">Parent</option>
                        <option value="child">Child</option>
                        <option value="sibling">Sibling</option>
                        <option value="spouse">Spouse</option>
                        <option value="grandparent">Grandparent</option>
                        <option value="grandchild">Grandchild</option>
                        <option value="aunt">Aunt</option>
                        <option value="uncle">Uncle</option>
                        <option value="cousin">Cousin</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div>
                    <label for="memberEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="memberEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="Enter email address">
                </div>
                
                <div>
                    <label for="memberWallet" class="block text-sm font-medium text-gray-700 mb-2">Wallet Address (Optional)</label>
                    <input type="text" id="memberWallet" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="Algorand wallet address">
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancelAddMember" class="px-6 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-teal-700 text-white rounded-lg hover:bg-teal-800 transition-colors">
                        Add Member
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div id="memberDetailsModal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 id="memberDetailsName" class="text-2xl font-bold text-gray-900"></h3>
                <button id="closeMemberDetailsModal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div id="memberDetailsContent" class="space-y-4">
                <!-- Member details will be populated here -->
            </div>
            
            <div class="flex justify-end space-x-3 pt-6 border-t">
                <button id="editMemberBtn" class="px-6 py-2 bg-teal-700 text-white rounded-lg hover:bg-teal-800 transition-colors">
                    Edit Member
                </button>
                <button id="shareMemoriesBtn" class="px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                    Share Memories
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-teal-700 to-yellow-600 flex items-center justify-center">
                        <span class="text-white font-bold text-sm">MC</span>
                    </div>
                    <span class="text-xl font-bold">MemoryChain</span>
                </div>
                <p class="text-gray-400 mb-4">Securing digital legacies for generations to come</p>
                <p class="text-sm text-gray-500">© 2024 MemoryChain. Built on Algorand blockchain with love for families worldwide.</p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        class FamilyTreeManager {
            constructor() {
                this.familyData = {
                    name: "You",
                    id: "user",
                    children: [
                        {
                            name: "John Smith",
                            id: "father",
                            relationship: "Father",
                            children: [
                                { name: "Grandpa Smith", id: "grandpa-father", relationship: "Grandfather" },
                                { name: "Grandma Smith", id: "grandma-father", relationship: "Grandmother" }
                            ]
                        },
                        {
                            name: "Sarah Smith",
                            id: "mother",
                            relationship: "Mother",
                            children: [
                                { name: "Grandpa Johnson", id: "grandpa-mother", relationship: "Grandfather" },
                                { name: "Grandma Johnson", id: "grandma-mother", relationship: "Grandmother" }
                            ]
                        },
                        {
                            name: "Emma Smith",
                            id: "sister",
                            relationship: "Sister"
                        },
                        {
                            name: "Michael Smith",
                            id: "brother",
                            relationship: "Brother"
                        }
                    ]
                };
                
                this.members = [
                    { id: 'user', name: 'You', relationship: 'Self', avatar: '👤', memories: 45, lastActive: '2 hours ago', wallet: '7F3X2Y...K6L9M0N' },
                    { id: 'father', name: 'John Smith', relationship: 'Father', avatar: '👨', memories: 32, lastActive: '1 day ago', wallet: '8G4H5J...L0M1N2P' },
                    { id: 'mother', name: 'Sarah Smith', relationship: 'Mother', avatar: '👩', memories: 28, lastActive: '3 hours ago', wallet: '9I5K6L...M2N3O4Q' },
                    { id: 'sister', name: 'Emma Smith', relationship: 'Sister', avatar: '👧', memories: 18, lastActive: '1 week ago', wallet: '0J6M7N...N3O4P5R' },
                    { id: 'brother', name: 'Michael Smith', relationship: 'Brother', avatar: '👦', memories: 12, lastActive: '2 days ago', wallet: '1K7N8O...O4P5Q6S' },
                    { id: 'grandpa-father', name: 'Robert Smith', relationship: 'Grandfather', avatar: '👴', memories: 8, lastActive: '1 month ago', wallet: '2L8O9P...P5Q6R7T' },
                    { id: 'grandma-father', name: 'Mary Smith', relationship: 'Grandmother', avatar: '👵', memories: 15, lastActive: '2 weeks ago', wallet: '3M9P0Q...Q6R7S8U' }
                ];
                
                this.sharedMemories = [
                    { id: 1, title: 'Family Vacation 2023', type: 'photo', sharedBy: 'father', date: '2023-08-15', thumbnail: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=300&h=200&fit=crop' },
                    { id: 2, title: 'Christmas Morning', type: 'video', sharedBy: 'mother', date: '2023-12-25', thumbnail: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=300&h=200&fit=crop' },
                    { id: 3, title: 'Emma\'s Graduation', type: 'photo', sharedBy: 'sister', date: '2024-05-20', thumbnail: 'https://images.unsplash.com/photo-1551434678-e076c223a692?w=300&h=200&fit=crop' },
                    { id: 4, title: 'Family Recipe Collection', type: 'document', sharedBy: 'mother', date: '2024-01-10', thumbnail: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=300&h=200&fit=crop' },
                    { id: 5, title: 'Grandpa\'s Stories', type: 'audio', sharedBy: 'grandpa-father', date: '2024-02-15', thumbnail: 'https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=300&h=200&fit=crop' },
                    { id: 6, title: 'Birthday Celebration', type: 'photo', sharedBy: 'brother', date: '2024-03-10', thumbnail: 'https://images.unsplash.com/photo-1519741497674-611481863552?w=300&h=200&fit=crop' }
                ];
                
                this.zoomLevel = 1;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.renderFamilyTree();
                this.renderFamilyGrid();
                this.renderSharedMemories();
            }
            
            setupEventListeners() {
                // Modal controls
                document.getElementById('addMemberBtn').addEventListener('click', () => this.openAddMemberModal());
                document.getElementById('closeAddModal').addEventListener('click', () => this.closeAddMemberModal());
                document.getElementById('cancelAddMember').addEventListener('click', () => this.closeAddMemberModal());
                document.getElementById('closeMemberDetailsModal').addEventListener('click', () => this.closeMemberDetailsModal());
                
                // Form submission
                document.getElementById('addMemberForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addFamilyMember();
                });
                
                // Tree controls
                document.getElementById('zoomIn').addEventListener('click', () => this.zoomIn());
                document.getElementById('zoomOut').addEventListener('click', () => this.zoomOut());
                document.getElementById('resetView').addEventListener('click', () => this.resetView());
                document.getElementById('expandAllBtn').addEventListener('click', () => this.expandAll());
                document.getElementById('collapseAllBtn').addEventListener('click', () => this.collapseAll());
                
                // Modal backdrop clicks
                document.getElementById('addMemberModal').addEventListener('click', (e) => {
                    if (e.target.id === 'addMemberModal') this.closeAddMemberModal();
                });
                
                document.getElementById('memberDetailsModal').addEventListener('click', (e) => {
                    if (e.target.id === 'memberDetailsModal') this.closeMemberDetailsModal();
                });
            }
            
            renderFamilyTree() {
                const container = document.getElementById('familyTree');
                const width = container.clientWidth;
                const height = 600;
                
                // Clear existing content
                d3.select('#familyTree').selectAll('*').remove();
                
                const svg = d3.select('#familyTree')
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .style('background', 'linear-gradient(135deg, #fafafa 0%, #f8f6f0 100%)');
                
                const g = svg.append('g')
                    .attr('transform', `translate(${width / 2}, 50)`);
                
                // Create tree layout
                const tree = d3.tree()
                    .size([width - 200, height - 100])
                    .separation((a, b) => (a.parent === b.parent ? 1 : 2) / a.depth);
                
                // Convert data to hierarchy
                const root = d3.hierarchy(this.familyData);
                tree(root);
                
                // Add links
                g.selectAll('.link')
                    .data(root.links())
                    .enter().append('path')
                    .attr('class', 'link')
                    .attr('d', d3.linkVertical()
                        .x(d => d.x)
                        .y(d => d.y));
                
                // Add nodes
                const nodes = g.selectAll('.node')
                    .data(root.descendants())
                    .enter().append('g')
                    .attr('class', 'node')
                    .attr('transform', d => `translate(${d.x}, ${d.y})`)
                    .on('click', (event, d) => this.showMemberDetails(d.data.id || 'user'));
                
                nodes.append('circle')
                    .attr('r', 25);
                
                nodes.append('text')
                    .text(d => d.data.name.split(' ')[0]);
                
                // Add relationship labels
                nodes.filter(d => d.data.relationship)
                    .append('text')
                    .attr('y', 40)
                    .attr('class', 'generation-label')
                    .text(d => d.data.relationship);
                
                // Add zoom behavior
                const zoom = d3.zoom()
                    .scaleExtent([0.5, 3])
                    .on('zoom', (event) => {
                        g.attr('transform', event.transform);
                        this.zoomLevel = event.transform.k;
                        document.getElementById('zoomLevel').textContent = Math.round(this.zoomLevel * 100) + '%';
                    });
                
                svg.call(zoom);
                
                // Animate tree appearance
                nodes.style('opacity', 0)
                    .transition()
                    .duration(800)
                    .delay((d, i) => i * 100)
                    .style('opacity', 1);
                
                links.style('opacity', 0)
                    .transition()
                    .duration(800)
                    .delay((d, i) => i * 50 + 200)
                    .style('opacity', 0.8);
            }
            
            renderFamilyGrid() {
                const container = document.getElementById('familyGrid');
                container.innerHTML = '';
                
                this.members.forEach(member => {
                    const memberCard = document.createElement('div');
                    memberCard.className = 'member-card rounded-xl p-6 cursor-pointer';
                    memberCard.innerHTML = `
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-teal-100 to-yellow-100 rounded-full flex items-center justify-center text-2xl">
                                ${member.avatar}
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">${member.name}</h3>
                                <p class="text-sm text-gray-600">${member.relationship}</p>
                                <p class="text-xs text-gray-500 font-mono">${member.wallet}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="text-center">
                                <div class="memory-count text-2xl font-bold">${member.memories}</div>
                                <div class="text-xs text-gray-500">Memories</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600">${member.lastActive}</div>
                                <div class="text-xs text-gray-500">Last Active</div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button class="flex-1 bg-teal-700 text-white py-2 px-3 rounded-lg text-sm hover:bg-teal-800 transition-colors">
                                View Profile
                            </button>
                            <button class="bg-yellow-600 text-white py-2 px-3 rounded-lg text-sm hover:bg-yellow-700 transition-colors">
                                Share
                            </button>
                        </div>
                    `;
                    
                    memberCard.addEventListener('click', () => this.showMemberDetails(member.id));
                    container.appendChild(memberCard);
                });
                
                // Animate cards
                anime({
                    targets: '.member-card',
                    opacity: [0, 1],
                    translateY: [20, 0],
                    delay: anime.stagger(100),
                    duration: 600,
                    easing: 'easeOutCubic'
                });
            }
            
            renderSharedMemories() {
                const container = document.getElementById('sharedMemories');
                container.innerHTML = '';
                
                this.sharedMemories.forEach(memory => {
                    const memoryCard = document.createElement('div');
                    memoryCard.className = 'bg-white rounded-xl overflow-hidden shadow-lg cursor-pointer hover:shadow-xl transition-all';
                    memoryCard.innerHTML = `
                        <div class="relative">
                            <img src="${memory.thumbnail}" alt="${memory.title}" class="w-full h-48 object-cover">
                            <div class="absolute top-2 right-2">
                                <span class="bg-black bg-opacity-50 text-white px-2 py-1 rounded-full text-xs">
                                    ${memory.type.toUpperCase()}
                                </span>
                            </div>
                            <div class="absolute top-2 left-2">
                                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-gray-900 mb-2">${memory.title}</h3>
                            <div class="flex justify-between items-center text-sm text-gray-500 mb-3">
                                <span>Shared by ${this.getMemberName(memory.sharedBy)}</span>
                                <span>${new Date(memory.date).toLocaleDateString()}</span>
                            </div>
                            <div class="flex space-x-2">
                                <button class="flex-1 bg-teal-700 text-white py-2 px-3 rounded-lg text-sm hover:bg-teal-800 transition-colors">
                                    View Memory
                                </button>
                                <button class="bg-gray-200 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-300 transition-colors">
                                    🔗
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(memoryCard);
                });
                
                // Animate memory cards
                anime({
                    targets: '#sharedMemories > div',
                    opacity: [0, 1],
                    translateY: [30, 0],
                    delay: anime.stagger(150),
                    duration: 800,
                    easing: 'easeOutCubic'
                });
            }
            
            getMemberName(memberId) {
                const member = this.members.find(m => m.id === memberId);
                return member ? member.name : 'Unknown';
            }
            
            showMemberDetails(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (!member) return;
                
                document.getElementById('memberDetailsName').textContent = member.name;
                document.getElementById('memberDetailsContent').innerHTML = `
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-20 h-20 bg-gradient-to-br from-teal-100 to-yellow-100 rounded-full flex items-center justify-center text-3xl">
                            ${member.avatar}
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900">${member.name}</h4>
                            <p class="text-gray-600">${member.relationship}</p>
                            <p class="text-sm text-gray-500 font-mono">${member.wallet}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-teal-700">${member.memories}</div>
                            <div class="text-sm text-gray-600">Shared Memories</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-sm text-gray-600">Last Active</div>
                            <div class="font-semibold text-gray-900">${member.lastActive}</div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Access Level:</span>
                            <span class="font-semibold text-green-600">Full Access</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Trust Score:</span>
                            <span class="font-semibold text-teal-700">95%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Member Since:</span>
                            <span class="font-semibold text-gray-900">Jan 15, 2024</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('memberDetailsModal').classList.remove('hidden');
                
                anime({
                    targets: '#memberDetailsModal > div',
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutCubic'
                });
            }
            
            closeMemberDetailsModal() {
                anime({
                    targets: '#memberDetailsModal > div',
                    scale: [1, 0.8],
                    opacity: [1, 0],
                    duration: 200,
                    easing: 'easeInCubic',
                    complete: () => {
                        document.getElementById('memberDetailsModal').classList.add('hidden');
                    }
                });
            }
            
            openAddMemberModal() {
                document.getElementById('addMemberModal').classList.remove('hidden');
                
                anime({
                    targets: '#addMemberModal > div',
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutCubic'
                });
            }
            
            closeAddMemberModal() {
                anime({
                    targets: '#addMemberModal > div',
                    scale: [1, 0.8],
                    opacity: [1, 0],
                    duration: 200,
                    easing: 'easeInCubic',
                    complete: () => {
                        document.getElementById('addMemberModal').classList.add('hidden');
                        document.getElementById('addMemberForm').reset();
                    }
                });
            }
            
            addFamilyMember() {
                const name = document.getElementById('memberName').value;
                const relationship = document.getElementById('memberRelationship').value;
                const email = document.getElementById('memberEmail').value;
                const wallet = document.getElementById('memberWallet').value;
                
                // Generate avatar based on relationship
                const avatars = {
                    parent: '👨',
                    child: '👶',
                    sibling: '👧',
                    spouse: '💑',
                    grandparent: '👴',
                    grandchild: '👶',
                    aunt: '👩',
                    uncle: '👨',
                    cousin: '👤',
                    other: '👤'
                };
                
                const newMember = {
                    id: 'member-' + Date.now(),
                    name: name,
                    relationship: relationship.charAt(0).toUpperCase() + relationship.slice(1),
                    avatar: avatars[relationship] || '👤',
                    memories: 0,
                    lastActive: 'Never',
                    wallet: wallet || 'Not set'
                };
                
                this.members.push(newMember);
                this.renderFamilyGrid();
                this.closeAddMemberModal();
                
                // Show success notification
                this.showNotification(`${name} added to family tree!`, 'success');
            }
            
            zoomIn() {
                this.zoomLevel = Math.min(this.zoomLevel * 1.2, 3);
                this.updateZoom();
            }
            
            zoomOut() {
                this.zoomLevel = Math.max(this.zoomLevel / 1.2, 0.5);
                this.updateZoom();
            }
            
            resetView() {
                this.zoomLevel = 1;
                this.updateZoom();
            }
            
            updateZoom() {
                document.getElementById('zoomLevel').textContent = Math.round(this.zoomLevel * 100) + '%';
                // Apply zoom to D3 visualization
                const svg = d3.select('#familyTree svg');
                svg.transition().duration(300).call(
                    d3.zoom().transform,
                    d3.zoomIdentity.scale(this.zoomLevel)
                );
            }
            
            expandAll() {
                // Implementation for expanding all tree nodes
                this.showNotification('All nodes expanded', 'info');
            }
            
            collapseAll() {
                // Implementation for collapsing all tree nodes
                this.showNotification('All nodes collapsed', 'info');
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium`;
                
                switch (type) {
                    case 'success':
                        notification.classList.add('bg-green-500');
                        break;
                    case 'error':
                        notification.classList.add('bg-red-500');
                        break;
                    case 'warning':
                        notification.classList.add('bg-yellow-500');
                        break;
                    default:
                        notification.classList.add('bg-blue-500');
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                anime({
                    targets: notification,
                    translateX: [300, 0],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutCubic'
                });
                
                setTimeout(() => {
                    anime({
                        targets: notification,
                        translateX: [0, 300],
                        opacity: [1, 0],
                        duration: 300,
                        easing: 'easeInCubic',
                        complete: () => {
                            document.body.removeChild(notification);
                        }
                    });
                }, 3000);
            }
        }
        
        // Initialize family tree manager
        let familyTreeManager;
        document.addEventListener('DOMContentLoaded', () => {
            familyTreeManager = new FamilyTreeManager();
        });
    </script>
</body>
</html>